cmdline-opts: [_fcall, {priority: 9999}, get_cmdline_params]
# priority will be fixed with next release of pukala, which includes
# global / local fcall dependencies with wildcards
default-config:
  # from project's /test folder
  test-stage: test-stage
  output-file-name: ncd-output.yaml
  output-step-file-name: ncd-output-steps.yaml
  case: simple-talk
  hedera-credentials-file: hedera-credentials.cfg
  # if simulated hedera is started, localhost:<hedera-simulated-port>
  # is overriding this value
  hedera-node-endpoint: 0.testnet.hedera.com:50211
  hedera-node-id: [0, 0, 3]
  hedera-mirror-endpoint: hcs.testnet.mirrornode.hedera.com:5600
  hedera-create-topic-settle-time: 10
  hedera-topic-id: null
  hedera-simulated-port: 50051
test-config:
  test-stage: [_fcall, {priority: 2000}, get_opt]
  test-stage-absolute: [_fcall, {priority: 1900}, ensure_test_folder]
  output-file-name: [_fcall, {priority: 2000}, get_opt]
  output-step-file-name: [_fcall, {priority: 2000}, get_opt]
  test-time: [_fcall, {priority: 2000}, get_datetime]
  case: [_fcall, {priority: 2000}, get_opt]
  hedera-credentials-file: [_fcall, {priority: 2000}, get_opt]
  hedera-account-id: [_fcall, {priority: 1900}, get_hedera_account_id]
  hedera-node-endpoint: [_fcall, {priority: 2000}, get_opt]
  hedera-node-id: [_fcall, {priority: 2000}, get_opt, int_arr]
  hedera-mirror-endpoint: [_fcall, {priority: 2000}, get_opt]
  hedera-create-topic-settle-time: [_fcall, {priority: 2000}, get_opt, int]
  hedera-topic-id: [_fcall, {priority: 2000}, get_opt, int_arr]
  hedera-simulated-port: [_fcall, {priority: 2000}, get_opt, int_arr]
  git-commit-hash: [_fcall, {priority: 1900}, get_git_commit_hash]
_fcall_conf:
  ignored:
    - [path, /scraps]
  sort:
    "^/$":
      - test-config
      - steps
    "^/steps/[\\d]*/$":
      - instance
      - parts
      - input
      - state
      - new-state
      - output
scraps:
  parts:
    hedera-transaction-id:
      _type: TransactionID
      transactionValidStart:
        _type: Timestamp
        seconds: [_fcall, get_seconds_from_epoch]
        nanos: 0
      accountID:
        _type: AccountID
        shardNum: [_fcall, do_getval, /test-config/hedera-account-id/0]
        realmNum: [_fcall, do_getval, /test-config/hedera-account-id/1]
        accountNum: [_fcall, do_getval, /test-config/hedera-account-id/2]
    gradido-topic-id:
      _type: TopicID
      shardNum: [_fcall, do_getval, /test-config/hedera-topic-id/0]
      realmNum: [_fcall, do_getval, /test-config/hedera-topic-id/1]
      topicNum: [_fcall, do_getval, /test-config/hedera-topic-id/2]
    gradido-add-user-message-body:
      _type: GradidoTransaction
      _use_with: SerializeToString
      sig_map:
        _type: gradido_SignatureMap
        sig_pair:
          - _type: gradido_SignaturePair
            pub_key: "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
            ed25519: "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
      body_bytes:
        _type: gradido_TransactionBody
        _use_with: SerializeToString
        memo: adding user
        group_member_update:
          _type: GroupMemberUpdate
          user_pubkey: [_fcall, {priority: 100000}, do_getval, ../../../../user-id]    
          member_update_type: 0
        version_number: 1
    gradido-creation-message-body:
      _type: GradidoTransaction
      _use_with: SerializeToString
      sig_map:
        _type: gradido_SignatureMap
        sig_pair:
          - _type: gradido_SignaturePair
            pub_key: "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
            ed25519: "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
      body_bytes:
        _type: gradido_TransactionBody
        _use_with: SerializeToString
        memo: creating
        creation:
          _type: GradidoCreation
          receiver:
            _type: Amount
            pubkey: [_fcall, {priority: 100000}, do_getval, ../../../../../user-id]    
            amount: [_fcall, {priority: 100000}, do_getval, ../../../../../amount]
        version_number: 1
    gradido-transfer-message-body:
      _type: GradidoTransaction
      _use_with: SerializeToString
      sig_map:
        _type: gradido_SignatureMap
        sig_pair:
          - _type: gradido_SignaturePair
            pub_key: "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
            ed25519: "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
      body_bytes:
        _type: gradido_TransactionBody
        _use_with: SerializeToString
        memo: hello!
        transfer:
          _type: GradidoTransfer
          local:
            sender:
              _type: Amount
              pubkey: [_fcall, {priority: 100000}, do_getval, ../../../../../../sender]    
              amount: [_fcall, {priority: 100000}, do_getval, ../../../../../../amount]
            receiver: [_fcall, {priority: 100000}, do_getval, ../../../../../receiver]
        version_number: 1
    hedera-custom-message-body:
      _type: TransactionBody
      _use_with: SerializeToString
      consensusSubmitMessage:
        _type: ConsensusSubmitMessageTransactionBody
        message: [_fcall, do_getval, ../../../message]
        topicID: [_fcall, do_getval, ../../../topic-id]
      transactionID: [_fcall, do_getval, ../../transaction-id]
      nodeAccountID:
        _type: AccountID
        shardNum: [_fcall, do_getval, /test-config/hedera-node-id/0]
        realmNum: [_fcall, do_getval, /test-config/hedera-node-id/1]
        accountNum: [_fcall, do_getval, /test-config/hedera-node-id/2]
      transactionValidDuration:
        _type: Duration
        seconds: 100
      transactionFee: 1000000
  # assorted step templates
  steps:
    create-topic:
      instance: login-server
      state:
        topic-id: null
      output:
        type: create-topic
    create-topic-receive:        
      instance: hedera-service
      input-from: [_fcall, {priority: 700}, get_input_from]
      state:
        topic-ids: []
      new-state:
        topic-ids: [_fcall, {priority: 600}, append_topic_id, ../state]
      output:
        topic-id: [_fcall, {priority: 500}, do_getval, ../../new-state/topic-ids/-1]
    create-topic-response:
      instance: login-server
      input-from: [_fcall, {priority: 700}, get_input_from]
      state-from: [_fcall, {priority: 600}, get_state_from]
      state-new:
        topic-id: [_fcall, {priority: 500}, do_getval, ../../input-from/val/topic-id]
    alice-hello:
      instance: alice
      output: hello, bob
    bob-answers-hello:
      instance: bob
      input: [_fcall, {priority: 700}, get_input_from]
      state: [_fcall, {priority: 600}, get_state_from]
      new-state:
        received-hello: [_fcall, {priority: 600}, contains_hello,
          [_fcall, do_getval, ../../input/val],
          [_fcall, do_getval, ../../state]]
      output: [_fcall, {priority: 500}, get_answer,
          [_fcall, do_getval, ../state]]
    hedera-login-create-topic:
      instance: login-server
      output:
      ####### createTopic
      - _class: ConsensusServiceStub
        _method: createTopic
        _arg:
          request:
            _type: Transaction
            bodyBytes:
              _type: TransactionBody
              _use_with: SerializeToString
              consensusCreateTopic:
                _type: ConsensusCreateTopicTransactionBody
                memo: just some topic
                autoRenewPeriod:
                  _type: Duration
                  seconds: 7000000
              transactionID:
                _type: TransactionID
                transactionValidStart:
                  _type: Timestamp
                  seconds: [_fcall, get_seconds_from_epoch]
                accountID:
                  _type: AccountID
                  shardNum: [_fcall, do_getval, /test-config/hedera-account-id/0]
                  realmNum: [_fcall, do_getval, /test-config/hedera-account-id/1]
                  accountNum: [_fcall, do_getval, /test-config/hedera-account-id/2]
              nodeAccountID:
                _type: AccountID
                shardNum: [_fcall, do_getval, /test-config/hedera-node-id/0]
                realmNum: [_fcall, do_getval, /test-config/hedera-node-id/1]
                accountNum: [_fcall, do_getval, /test-config/hedera-node-id/2]
              transactionValidDuration:
                _type: Duration
                seconds: 100
              transactionFee: 100000000
            sigMap:
              _type: SignatureMap
              _pass: 1
              sigPair:
                - _type: SignaturePair
                  # those are populated when serialization occurs
                  pubKeyPrefix:
                    _type: PubKeyWrapper
                    _use_with: str
                    context:
                      _type: HederaContext
                    # -1 for current transaction (all transactions are
                    # accumulated in a list as they are prepared and
                    # executed; -1 is last); also, only _arg data is
                    # accumulated, therefore second segment is "request"
                    body_path: /-1/request/bodyBytes/_transformed_use_with
                  ed25519:
                    _type: ed25519Signature
                    _use_with: str
                    context:
                      _type: HederaContext
                    body_path: /-1/request/bodyBytes/_transformed_use_with
      ####### end createTopic
      ####### wait
      - _class: Utils
        _method: sleep
        _arg:
          settle_time: [_fcall, do_getval, /test-config/hedera-create-topic-settle-time]
      ####### getTransactionReceipts
      - _class: CryptoServiceStub
        _method: getTransactionReceipts
        _arg:
          request:
            _type: Query
            transactionGetReceipt:
              _type: TransactionGetReceiptQuery
              header:
                _type: QueryHeader
              transactionID:
                _type: SomeTransactionID
                _use_with: get_grpc_obj
                context:
                  _type: HederaContext
                transaction_path: /0/request/bodyBytes/transactionID/_transformed
    hedera-serve-transaction:
      instance: hedera-node-service
      input: [_fcall, {priority: 1700}, get_input_from]
      output: [_fcall, {priority: 1600}, do_hedera_calls]
    hedera-login-submit-message:
      instance: login-server
      output:
      ####### submitMessage
      - _class: ConsensusServiceStub
        _method: submitMessage
        _arg:
          request:
            _type: Transaction
            bodyBytes:
              _type: TransactionBody
              _use_with: SerializeToString
              consensusSubmitMessage:
                _type: ConsensusSubmitMessageTransactionBody
                message: "hello"
                topicID:
                  _type: TopicID
                  shardNum: [_fcall, do_getval, /test-config/hedera-topic-id/0]
                  realmNum: [_fcall, do_getval, /test-config/hedera-topic-id/1]
                  topicNum: [_fcall, do_getval, /test-config/hedera-topic-id/2]
              transactionID:
                _type: TransactionID
                transactionValidStart:
                  _type: Timestamp
                  seconds: [_fcall, get_seconds_from_epoch]
                accountID:
                  _type: AccountID
                  shardNum: [_fcall, do_getval, /test-config/hedera-account-id/0]
                  realmNum: [_fcall, do_getval, /test-config/hedera-account-id/1]
                  accountNum: [_fcall, do_getval, /test-config/hedera-account-id/2]
              nodeAccountID:
                _type: AccountID
                shardNum: [_fcall, do_getval, /test-config/hedera-node-id/0]
                realmNum: [_fcall, do_getval, /test-config/hedera-node-id/1]
                accountNum: [_fcall, do_getval, /test-config/hedera-node-id/2]
              transactionValidDuration:
                _type: Duration
                seconds: 100
              transactionFee: 1000000
            sigMap:
              _type: SignatureMap
              _pass: 1
              sigPair:
                - _type: SignaturePair
                  pubKeyPrefix:
                    _type: PubKeyWrapper
                    _use_with: str
                    context:
                      _type: HederaContext
                    body_path: /-1/request/bodyBytes/_transformed_use_with
                  ed25519:
                    _type: ed25519Signature
                    _use_with: str
                    context:
                      _type: HederaContext
                    body_path: /-1/request/bodyBytes/_transformed_use_with
      ####### end submitMessage
    hedera-login-submit-gradido-message:
      instance: login-server
      output:
      ####### submitGradidoMessage
      - _class: ConsensusServiceStub
        _method: submitMessage
        _arg:
          request:
            _type: Transaction
            bodyBytes:
              _type: TransactionBody
              _use_with: SerializeToString
              consensusSubmitMessage:
                _type: ConsensusSubmitMessageTransactionBody
                message:
                  _type: Transaction_gradido
                  _use_with: SerializeToString
                  transaction_type: 0
                  gradido_transaction:
                    _type: GradidoTransaction
                    gradido_transfer_type: 0
                    local: 
                      _type: LocalTransfer
                      user_from:
                        _type: Participant
                        user_id: 1
                      user_to:
                        _type: Participant
                        user_id: 2
                    amount: 10
                    amount_with_deduction: 11
                    sender_signature: "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
                  version_number: 1
                  reserved: "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"
                topicID:
                  _type: TopicID
                  shardNum: [_fcall, do_getval, /test-config/hedera-topic-id/0]
                  realmNum: [_fcall, do_getval, /test-config/hedera-topic-id/1]
                  topicNum: [_fcall, do_getval, /test-config/hedera-topic-id/2]
              transactionID:
                _type: TransactionID
                transactionValidStart:
                  _type: Timestamp
                  seconds: [_fcall, get_seconds_from_epoch]
                accountID:
                  _type: AccountID
                  shardNum: [_fcall, do_getval, /test-config/hedera-account-id/0]
                  realmNum: [_fcall, do_getval, /test-config/hedera-account-id/1]
                  accountNum: [_fcall, do_getval, /test-config/hedera-account-id/2]
              nodeAccountID:
                _type: AccountID
                shardNum: [_fcall, do_getval, /test-config/hedera-node-id/0]
                realmNum: [_fcall, do_getval, /test-config/hedera-node-id/1]
                accountNum: [_fcall, do_getval, /test-config/hedera-node-id/2]
              transactionValidDuration:
                _type: Duration
                seconds: 100
              transactionFee: 1000000
            sigMap:
              _type: SignatureMap
              _pass: 1
              sigPair:
                - _type: SignaturePair
                  pubKeyPrefix:
                    _type: PubKeyWrapper
                    _use_with: str
                    context:
                      _type: HederaContext
                    body_path: /-1/request/bodyBytes/_transformed_use_with
                  ed25519:
                    _type: ed25519Signature
                    _use_with: str
                    context:
                      _type: HederaContext
                    body_path: /-1/request/bodyBytes/_transformed_use_with
      ####### end submitGradidoMessage

    ####### customGradidoMessage      
    hedera-login-custom-message:
      _class: ConsensusServiceStub
      _method: submitMessage
      _arg:
        request:
          _type: Transaction
          bodyBytes: [_fcall, do_getval, ../../../../../parts/message-body]
          sigMap:
            _type: SignatureMap
            _pass: 1
            sigPair:
              - _type: SignaturePair
                pubKeyPrefix:
                  _type: PubKeyWrapper
                  _use_with: str
                  context:
                    _type: HederaContext
                  body_path: /-1/request/bodyBytes/_transformed_use_with
                ed25519:
                  _type: ed25519Signature
                  _use_with: str
                  context:
                    _type: HederaContext
                  body_path: /-1/request/bodyBytes/_transformed_use_with
    ####### end customGradidoMessage

    sleep-10:
      instance: sleeper
      output: [_fcall, do_sleep, 10]
    sleep-3:
      instance: sleeper
      output: [_fcall, do_sleep, 3]
    sleep-2:
      instance: sleeper
      output: [_fcall, do_sleep, 2]
  cases:
    # just demonstrating talk involving two parties, with usage of state
    simple-talk:
      - [_fcall, do_getval, /scraps/steps/alice-hello]
      - [_fcall, do_getval, /scraps/steps/bob-answers-hello]
      - [_fcall, do_getval, /scraps/steps/alice-hello]
      - [_fcall, do_getval, /scraps/steps/bob-answers-hello]
    # communication between steps exclusively via input-output fields,
    # which simulates real-world process
    create-topic:
      - [_fcall, do_getval, /scraps/steps/create-topic]
      - [_fcall, do_getval, /scraps/steps/create-topic-receive]
      - [_fcall, do_getval, /scraps/steps/create-topic-response]
    hedera-create-topic:
      - [_fcall, {priority: 300}, do_getval, /scraps/steps/hedera-login-create-topic]
      - [_fcall, {deps: /steps/0}, do_getval, /scraps/steps/hedera-serve-transaction]
    create-group:
      - [_fcall, do_getval, /scraps/steps/create-topic]
      - [_fcall, do_getval, /scraps/steps/create-topic-receive]
      - instance: login-server
        input-from: [_fcall, {priority: 700}, get_input_from]
        state-from: [_fcall, {priority: 600}, get_state_from]
        state-new:
          topic-id: [_fcall, {priority: 500}, do_getval, ../../input-from/val/topic-id]
        output:
          type: submit-message
          value: hello, world
      - instance: hedera-service
        input-from: [_fcall, {priority: 700}, get_input_from]
        output:
          - type: transaction-accepted
            transaction-id: 1
          - type: notifying-subscribers
            value: [_fcall, {priority: 600}, do_getval, ../../../input-from/val/value]
      - instance: login-server
        input-from: [_fcall, {priority: 700}, get_input_from]
        state-from: [_fcall, {priority: 600}, get_state_from]
        state-new:
          topic-id: [_fcall, {priority: 500}, do_getval, ../../input-from/val/topic-id]
      - instance: gradido-node
        input-from: [_fcall, {priority: 700}, get_input_from, -1, 1]
    grpc-test-sleep:
      - instance: login-server
        output:
        - _class: Utils
          _method: sleep
          _arg:
            settle_time: [_fcall, {priority: 1010}, do_getval, /test-config/hedera-create-topic-settle-time]
      - [_fcall, {priority: 200}, do_getval, /scraps/steps/hedera-serve-transaction]
    hedera-submit-message:
      - [_fcall, {priority: 300}, do_getval, /scraps/steps/hedera-login-submit-message]
      - [_fcall, {deps: /steps/0}, do_getval, /scraps/steps/hedera-serve-transaction]
    hedera-submit-gradido-message:
      - [_fcall, {priority: 300}, do_getval, /scraps/steps/hedera-login-submit-gradido-message]
      - [_fcall, {deps: /steps/0}, do_getval, /scraps/steps/hedera-serve-transaction]
    gradido-custom-message:
      - parts:
          topic-id: [_fcall, {priority: 1110}, do_getval, /scraps/parts/gradido-topic-id]
          transaction-id: [_fcall, {priority: 1100}, do_getval, /scraps/parts/hedera-transaction-id]
          message: [_fcall, {priority: 1090}, do_getval, /scraps/parts/gradido-transfer-message-body]
          message-body: [_fcall, {priority: 1080}, do_getval, /scraps/parts/hedera-custom-message-body]
        output: 
          - [_fcall, {priority: -10000}, do_getval, /scraps/steps/hedera-login-custom-message]
    sydney:
      - instance: hedera-simulated
        state: [_fcall, {priority: -100}, start_simulated_hedera]
      - instance: gradido-node-0
        parts:
          listening-groups:
            - alias: t_blocks
              group_id: 1
              shardNum: [_fcall, do_getval, /test-config/hedera-topic-id/0]
              realmNum: [_fcall, do_getval, /test-config/hedera-topic-id/1]
              topicNum: [_fcall, do_getval, /test-config/hedera-topic-id/2]
          instance-root: [_fcall, {priority: 1100}, get_instance_root]
          conf:
            worker_count: 10
            io_worker_count: 1
            data_root_folder: [_fcall, {priority: 1090}, do_getval, ../../instance-root]
            # TODO: fix here; should get from config
            hedera_mirror_endpoint: localhost:50051
            blockchain_append_batch_size: 5
            blochchain_init_batch_size: 1000
            block_record_outbound_batch_size: 100
            group_requests_endpoint: 0.0.0.0:13701
            record_requests_endpoint: 0.0.0.0:13702
            manage_network_requests_endpoint: 0.0.0.0:13703
            sibling_node_file: [_fcall, {priority: 1090}, get_sibling_node_file]
        state: [_fcall, {deps: /steps/0}, start_gradido_node]
      - instance: login-server
        parts:
          topic-id: [_fcall, {priority: 1110}, do_getval, /scraps/parts/gradido-topic-id]
          transaction-id: [_fcall, {priority: 1100}, do_getval, /scraps/parts/hedera-transaction-id]
          message: [_fcall, {priority: 1090}, do_getval, /scraps/parts/gradido-transfer-message-body]
          message-body: [_fcall, {priority: 1080}, do_getval, /scraps/parts/hedera-custom-message-body]
        output: 
          - [_fcall, {deps: /steps/1}, do_getval, /scraps/steps/hedera-login-custom-message]
      - [_fcall, {deps: /steps/2}, do_getval, /scraps/steps/hedera-serve-transaction]
      - [_fcall, {deps: /steps/3}, do_getval, /scraps/steps/sleep-3]
      - instance: gradido-node-0
        state: [_fcall, {deps: /steps/4}, finish_gradido_node]
      - instance: hedera-simulated
        state: [_fcall, {deps: /steps/5}, finish_simulated_hedera]
    melbourne:
      - instance: hedera-simulated
        state: [_fcall, {priority: -100}, start_simulated_hedera]
      - instance: gradido-node-0
        parts:
          listening-groups:
            - alias: t_blocks
              group_id: 1
              shardNum: [_fcall, do_getval, /test-config/hedera-topic-id/0]
              realmNum: [_fcall, do_getval, /test-config/hedera-topic-id/1]
              topicNum: [_fcall, do_getval, /test-config/hedera-topic-id/2]
          instance-root: [_fcall, {priority: 1100}, get_instance_root]
          conf:
            worker_count: 10
            io_worker_count: 1
            data_root_folder: [_fcall, {priority: 1090}, do_getval, ../../instance-root]
            # TODO: fix here; should get from config
            hedera_mirror_endpoint: localhost:50051
            blockchain_append_batch_size: 5
            blochchain_init_batch_size: 1000
            block_record_outbound_batch_size: 100
            group_requests_endpoint: 0.0.0.0:13701
            record_requests_endpoint: 0.0.0.0:13702
            manage_network_requests_endpoint: 0.0.0.0:13703
            sibling_node_file: [_fcall, {priority: 1090}, get_sibling_node_file]
        state: [_fcall, {priority: -200}, start_gradido_node]
      - instance: login-server
        parts:
          topic-id: [_fcall, {priority: 1110}, do_getval, /scraps/parts/gradido-topic-id]
          transaction-id: [_fcall, {priority: 1100}, do_getval, /scraps/parts/hedera-transaction-id]
          user-id: "1111111111111111111111111111111111111111111111111111111111111111"      
          message: [_fcall, {priority: 1090}, do_getval, /scraps/parts/gradido-add-user-message-body]
          message-body: [_fcall, {priority: 880}, do_getval, /scraps/parts/hedera-custom-message-body]
        output: 
          - [_fcall, {priority: -300}, do_getval, /scraps/steps/hedera-login-custom-message]
      - [_fcall, {priority: -400}, do_getval, /scraps/steps/hedera-serve-transaction]
      - instance: login-server
        parts:
          topic-id: [_fcall, {priority: 1110}, do_getval, /scraps/parts/gradido-topic-id]
          transaction-id: [_fcall, {priority: 1100}, do_getval, /scraps/parts/hedera-transaction-id]
          user-id: "2222222222222222222222222222222222222222222222222222222222222222"      
          message: [_fcall, {priority: 1090}, do_getval, /scraps/parts/gradido-add-user-message-body]
          message-body: [_fcall, {priority: 1080}, do_getval, /scraps/parts/hedera-custom-message-body]
        output: 
          - [_fcall, {priority: -500}, do_getval, /scraps/steps/hedera-login-custom-message]
      - [_fcall, {priority: -600}, do_getval, /scraps/steps/hedera-serve-transaction]
      - instance: login-server
        parts:
          topic-id: [_fcall, {priority: 1110}, do_getval, /scraps/parts/gradido-topic-id]
          transaction-id: [_fcall, {priority: 1100}, do_getval, /scraps/parts/hedera-transaction-id]
          user-id: "1111111111111111111111111111111111111111111111111111111111111111"      
          amount: 500
          message: [_fcall, {priority: 1090}, do_getval, /scraps/parts/gradido-creation-message-body]
          message-body: [_fcall, {priority: 1080}, do_getval, /scraps/parts/hedera-custom-message-body]
        output: 
          - [_fcall, {priority: -700}, do_getval, /scraps/steps/hedera-login-custom-message]
      - [_fcall, {priority: -800}, do_getval, /scraps/steps/hedera-serve-transaction]
      - instance: login-server
        parts:
          topic-id: [_fcall, {priority: 1110}, do_getval, /scraps/parts/gradido-topic-id]
          transaction-id: [_fcall, {priority: 1100}, do_getval, /scraps/parts/hedera-transaction-id]
          sender: "1111111111111111111111111111111111111111111111111111111111111111"      
          receiver: "2222222222222222222222222222222222222222222222222222222222222222"      
          amount: 200
          message: [_fcall, {priority: 1090}, do_getval, /scraps/parts/gradido-transfer-message-body]
          message-body: [_fcall, {priority: 1080}, do_getval, /scraps/parts/hedera-custom-message-body]
        output: 
          - [_fcall, {priority: -830}, do_getval, /scraps/steps/hedera-login-custom-message]
      - [_fcall, {priority: -860}, do_getval, /scraps/steps/hedera-serve-transaction]
      - [_fcall, {priority: -900}, do_getval, /scraps/steps/sleep-3]
      - instance: gradido-node-0
        state: [_fcall, {priority: -1000}, finish_gradido_node]
      - instance: hedera-simulated
        state: [_fcall, {priority: -1100}, finish_simulated_hedera]
    brisbane:
      - instance: hedera-simulated
        state: [_fcall, {priority: -100}, start_simulated_hedera]
      - instance: gradido-node-0
        parts:
          listening-groups:
            - alias: t_blocks
              group_id: 1
              shardNum: [_fcall, do_getval, /test-config/hedera-topic-id/0]
              realmNum: [_fcall, do_getval, /test-config/hedera-topic-id/1]
              topicNum: [_fcall, do_getval, /test-config/hedera-topic-id/2]
          instance-root: [_fcall, {priority: 1100}, get_instance_root]
          conf:
            worker_count: 10
            io_worker_count: 1
            data_root_folder: [_fcall, {priority: 1090}, do_getval, ../../instance-root]
            # TODO: fix here; should get from config
            hedera_mirror_endpoint: localhost:50051
            blockchain_append_batch_size: 5
            blochchain_init_batch_size: 1000
            block_record_outbound_batch_size: 100
            group_requests_endpoint: 0.0.0.0:13701
            record_requests_endpoint: 0.0.0.0:13702
            manage_network_requests_endpoint: 0.0.0.0:13703
            sibling_node_file: [_fcall, {priority: 1090}, get_sibling_node_file]
        state: [_fcall, {priority: -200}, start_gradido_node]
      - instance: webapp-demo
        messages:
          hedera-message:
            _class: ConsensusServiceStub
            _method: submitMessage
            _arg:
              request:
                _type: Transaction
                bodyBytes: <insert here>
                sigMap:
                  _type: SignatureMap
                  _pass: 1
                  sigPair:
                    - _type: SignaturePair
                      pubKeyPrefix:
                        _type: PubKeyWrapper
                        _use_with: str
                        context:
                          _type: HederaContext
                        body_path: /-1/request/bodyBytes/_transformed_use_with
                      ed25519:
                        _type: ed25519Signature
                        _use_with: str
                        context:
                          _type: HederaContext
                        body_path: /-1/request/bodyBytes/_transformed_use_with
          add-user:
            parts:
              topic-id: [_fcall, {priority: 1110}, do_getval, /scraps/parts/gradido-topic-id]
              transaction-id: [_fcall, {priority: 1100}, do_getval, /scraps/parts/hedera-transaction-id]
              user-id: ""      
              message: [_fcall, {priority: 1090}, do_getval, /scraps/parts/gradido-add-user-message-body]
              message-body: [_fcall, {priority: 880}, do_getval, /scraps/parts/hedera-custom-message-body]
          create-gradidos:
            parts:
              topic-id: [_fcall, {priority: 1110}, do_getval, /scraps/parts/gradido-topic-id]
              transaction-id: [_fcall, {priority: 1100}, do_getval, /scraps/parts/hedera-transaction-id]
              user-id: ""      
              amount: 0
              message: [_fcall, {priority: 1090}, do_getval, /scraps/parts/gradido-creation-message-body]
              message-body: [_fcall, {priority: 880}, do_getval, /scraps/parts/hedera-custom-message-body]
          transfer:
            parts:
              topic-id: [_fcall, {priority: 1110}, do_getval, /scraps/parts/gradido-topic-id]
              transaction-id: [_fcall, {priority: 1100}, do_getval, /scraps/parts/hedera-transaction-id]
              sender: ""      
              receiver: ""      
              amount: 0
              message: [_fcall, {priority: 1090}, do_getval, /scraps/parts/gradido-transfer-message-body]
              message-body: [_fcall, {priority: 1080}, do_getval, /scraps/parts/hedera-custom-message-body]
        # hangs forever
        state: [_fcall, {priority: -400}, start, 36006]
    perth:
      - instance: gradido-node-0
        parts:
          listening-groups:
            - alias: t_blocks
              group_id: 1
              shardNum: [_fcall, do_getval, /test-config/hedera-topic-id/0]
              realmNum: [_fcall, do_getval, /test-config/hedera-topic-id/1]
              topicNum: [_fcall, do_getval, /test-config/hedera-topic-id/2]
          instance-root: [_fcall, {priority: 1100}, get_instance_root]
          conf:
            worker_count: 10
            io_worker_count: 1
            data_root_folder: [_fcall, {priority: 1090}, do_getval, ../../instance-root]
            hedera_mirror_endpoint: [_fcall, {priority: 1090}, do_getval, /test-config/hedera-mirror-endpoint]
            blockchain_append_batch_size: 5
            blochchain_init_batch_size: 1000
            block_record_outbound_batch_size: 100
            group_requests_endpoint: 0.0.0.0:13701
            record_requests_endpoint: 0.0.0.0:13702
            manage_network_requests_endpoint: 0.0.0.0:13703
            sibling_node_file: [_fcall, {priority: 1090}, get_sibling_node_file]
        state: [_fcall, {priority: -200}, start_gradido_node]
      - instance: webapp-demo
        messages:
          hedera-message:
            _class: ConsensusServiceStub
            _method: submitMessage
            _arg:
              request:
                _type: Transaction
                bodyBytes: <insert here>
                sigMap:
                  _type: SignatureMap
                  _pass: 1
                  sigPair:
                    - _type: SignaturePair
                      pubKeyPrefix:
                        _type: PubKeyWrapper
                        _use_with: str
                        context:
                          _type: HederaContext
                        body_path: /-1/request/bodyBytes/_transformed_use_with
                      ed25519:
                        _type: ed25519Signature
                        _use_with: str
                        context:
                          _type: HederaContext
                        body_path: /-1/request/bodyBytes/_transformed_use_with
          add-user:
            parts:
              topic-id: [_fcall, {priority: 1110}, do_getval, /scraps/parts/gradido-topic-id]
              transaction-id: [_fcall, {priority: 1100}, do_getval, /scraps/parts/hedera-transaction-id]
              user-id: ""      
              message: [_fcall, {priority: 1090}, do_getval, /scraps/parts/gradido-add-user-message-body]
              message-body: [_fcall, {priority: 880}, do_getval, /scraps/parts/hedera-custom-message-body]
          create-gradidos:
            parts:
              topic-id: [_fcall, {priority: 1110}, do_getval, /scraps/parts/gradido-topic-id]
              transaction-id: [_fcall, {priority: 1100}, do_getval, /scraps/parts/hedera-transaction-id]
              user-id: ""      
              amount: 0
              message: [_fcall, {priority: 1090}, do_getval, /scraps/parts/gradido-creation-message-body]
              message-body: [_fcall, {priority: 880}, do_getval, /scraps/parts/hedera-custom-message-body]
          transfer:
            parts:
              topic-id: [_fcall, {priority: 1110}, do_getval, /scraps/parts/gradido-topic-id]
              transaction-id: [_fcall, {priority: 1100}, do_getval, /scraps/parts/hedera-transaction-id]
              sender: ""      
              receiver: ""      
              amount: 0
              message: [_fcall, {priority: 1090}, do_getval, /scraps/parts/gradido-transfer-message-body]
              message-body: [_fcall, {priority: 1080}, do_getval, /scraps/parts/hedera-custom-message-body]
        # hangs forever
        state: [_fcall, {priority: -400}, start, 36006]
    empty: empty
steps: [_fcall, {priority: 1000}, do_getval, /scraps/cases/%s, [_fcall, do_getval, /test-config/case]]

